@model StudentManagementSystem.Models.Section

@{
    ViewData["Title"] = "تفاصيل الشعبة";
}

<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-sitemap mr-2"></i>
                        تفاصيل الشعبة: @Model.Name_Of_Section
                    </h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header bg-primary text-white">
                                    <h5 class="mb-0">
                                        <i class="fas fa-info-circle mr-2"></i>
                                        المعلومات الأساسية
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <dl class="row">
                                        <dt class="col-sm-4">
                                            <i class="fas fa-hashtag mr-2"></i>
                                            المعرف:
                                        </dt>
                                        <dd class="col-sm-8">
                                            <span class="badge badge-secondary">@Model.Id</span>
                                        </dd>

                                        <dt class="col-sm-4">
                                            <i class="fas fa-sitemap mr-2"></i>
                                            اسم الشعبة:
                                        </dt>
                                        <dd class="col-sm-8">
                                            <strong class="text-primary">@Model.Name_Of_Section</strong>
                                        </dd>

                                        <dt class="col-sm-4">
                                            <i class="fas fa-building mr-2"></i>
                                            القسم:
                                        </dt>
                                        <dd class="col-sm-8">
                                            <span class="badge badge-info">
                                                @(Model.Department.Name)
                                            </span>
                                        </dd>

                                        <dt class="col-sm-4">
                                            <i class="fas fa-toggle-on mr-2"></i>
                                            الحالة:
                                        </dt>
                                        <dd class="col-sm-8">
                                            @if (Model.IsActive)
                                            {
                                                <span class="badge badge-success">
                                                    <i class="fas fa-check mr-1"></i>
                                                    نشط
                                                </span>
                                            }
                                            else
                                            {
                                                <span class="badge badge-danger">
                                                    <i class="fas fa-times mr-1"></i>
                                                    غير نشط
                                                </span>
                                            }
                                        </dd>
                                    </dl>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header bg-success text-white">
                                    <h5 class="mb-0">
                                        <i class="fas fa-clock mr-2"></i>
                                        معلومات الإنشاء
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <dl class="row">
                                        <dt class="col-sm-4">
                                            <i class="fas fa-user mr-2"></i>
                                            أنشئت بواسطة:
                                        </dt>
                                        <dd class="col-sm-8">
                                            <strong>@(Model.CreatedBy?.Name ?? "غير محدد")</strong>
                                        </dd>

                                        <dt class="col-sm-4">
                                            <i class="fas fa-calendar mr-2"></i>
                                            تاريخ الإنشاء:
                                        </dt>
                                        <dd class="col-sm-8">
                                            <span class="badge badge-light">
                                                @Model.Date.ToString("dd/MM/yyyy")
                                            </span>
                                        </dd>

                                        <dt class="col-sm-4">
                                            <i class="fas fa-clock mr-2"></i>
                                            وقت الإنشاء:
                                        </dt>
                                        <dd class="col-sm-8">
                                            <span class="badge badge-light">
                                                @Model.Date.ToString("HH:mm:ss")
                                            </span>
                                        </dd>

                                        <dt class="col-sm-4">
                                            <i class="fas fa-calendar-day mr-2"></i>
                                            منذ:
                                        </dt>
                                        <dd class="col-sm-8">
                                            <span class="text-muted">
                                                @{
                                                    var daysDiff = (DateTime.Now - Model.Date).Days;
                                                    string timeAgo = daysDiff == 0 ? "اليوم" :
                                                    daysDiff == 1 ? "أمس" :
                                                    daysDiff < 30 ? $"{daysDiff} يوم" :
                                                    daysDiff < 365 ? $"{daysDiff / 30} شهر" :
                                                    $"{daysDiff / 365} سنة";
                                                }
                                                @timeAgo
                                            </span>
                                        </dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Statistics Card -->
                    <div class="card mb-4">
                        <div class="card-header bg-warning text-dark">
                            <h5 class="mb-0">
                                <i class="fas fa-chart-bar mr-2"></i>
                                إحصائيات الشعبة
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row text-center">
                                <div class="col-md-4">
                                    <div class="card bg-light">
                                        <div class="card-body">
                                            <h3 class="text-primary">
                                                <i class="fas fa-users"></i>
                                                @(Model.StudentClassSectionYears?.Count() ?? 0)
                                            </h3>
                                            <p class="card-text">عدد الطلاب المسجلين</p>
                                        </div>
                                    </div>
                                </div>
@*                                 <div class="col-md-4">
                                    <div class="card bg-light">
                                        <div class="card-body">
                                            <h3 class="text-success">
                                                <i class="fas fa-calendar-alt"></i>
                                                @{
                                                    var currentYear = DateTime.Now.Year;
                                                    var currentYearStudents = Model.StudentClassSectionYears?
                                                   
                                                    .Count() ?? 0;
                                                }
                                                @currentYearStudents
                                            </h3>
                                            <p class="card-text">طلاب العام الحالي</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card bg-light">
                                        <div class="card-body">
                                            <h3 class="text-info">
                                                <i class="fas fa-graduation-cap"></i>
                                                @{
                                                    var uniqueYears = Model.StudentClassSectionYears?
                                                    .Select(s => s.WorkingYear?.Year)
                                                    .Where(y => y.HasValue)
                                                    .Distinct()
                                                    .Count() ?? 0;
                                                }
                                                @uniqueYears
                                            </h3>
                                            <p class="card-text">سنوات التشغيل</p> 
                               </div>
                                    </div>
                                </div> *@
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="d-flex justify-content-between flex-wrap">
                        <div>
                            <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-warning mb-2">
                                <i class="fas fa-edit mr-2"></i>
                                تعديل الشعبة
                            </a>
                            <button type="button" class="btn btn-danger mb-2"
                                    data-toggle="modal" data-target="#deleteModal">
                                <i class="fas fa-trash mr-2"></i>
                                حذف الشعبة
                            </button>
                        </div>
                        <div>
                            <a asp-action="Index" class="btn btn-secondary mb-2">
                                <i class="fas fa-arrow-right mr-2"></i>
                                العودة إلى القائمة
                            </a>
                            <a asp-action="Create" class="btn btn-primary mb-2">
                                <i class="fas fa-plus mr-2"></i>
                                إضافة شعبة جديدة
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteModalLabel">
                    <i class="fas fa-exclamation-triangle mr-2"></i>
                    تأكيد الحذف
                </h5>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body text-center">
                <i class="fas fa-question-circle fa-3x text-warning mb-3"></i>
                <h5>هل أنت متأكد من حذف الشعبة؟</h5>
                <p class="text-muted">
                    ستقوم بحذف الشعبة: <strong>@Model.Name_Of_Section</strong>
                </p>
                <div class="alert alert-warning" role="alert">
                    <i class="fas fa-info-circle mr-2"></i>
                    تحذير: هذا الإجراء لا يمكن التراجع عنه!
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">
                    <i class="fas fa-times mr-2"></i>
                    إلغاء
                </button>
                <form asp-action="Delete" asp-route-id="@Model.Id" method="post" style="display: inline;">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="btn btn-danger" id="deleteBtn">
                        <i class="fas fa-trash mr-2"></i>
                        نعم، احذف
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // Handle delete confirmation
            $('#deleteBtn').on('click', function () {
                $(this).prop('disabled', true);
                $(this).html('<i class="fas fa-spinner fa-spin mr-2"></i>جاري الحذف...');
            });

            // Add hover effects to stat cards
            $('.card.bg-light').hover(
                function () {
                    $(this).addClass('shadow-sm border-primary');
                },
                function () {
                    $(this).removeClass('shadow-sm border-primary');
                }
            );

            // Animate numbers on page load
            $('.card-body h3').each(function () {
                var $this = $(this);
                var countTo = parseInt($this.text());

                $({ countNum: 0 }).animate({
                    countNum: countTo
                }, {
                    duration: 1000,
                    easing: 'linear',
                    step: function () {
                        var icon = $this.find('i').prop('outerHTML');
                        $this.html(icon + ' ' + Math.floor(this.countNum));
                    },
                    complete: function () {
                        var icon = $this.find('i').prop('outerHTML');
                        $this.html(icon + ' ' + this.countNum);
                    }
                });
            });
        });
    </script>
}