@model StudentManagementSystem.Models.Classes

@{
	ViewData["Title"] = "تعديل الفصل";
	Layout = null; // We are providing a full HTML structure, so no need for a layout here.
}
<head>
	<link href="~/css/styles.css" rel="stylesheet" />
</head>

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>@ViewData["Title"]</title>
	<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet" />
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
	<style>
				body {
						font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
						background-color: #f8f9fa;
						direction: rtl;

		}

				.card {
						border-radius: 20px;
						overflow: hidden;
						box-shadow: 0 5px 15px rgba(0,0,0,0.1);

		}

				.card-header {
						background: linear-gradient(135deg, #ff8a50 0%, #ff6b35 100%) !important; /* Orange gradient */
						color: white;
						border: none;
						padding: 20px 0;
						text-align: center;

		}

				.header-title {
						font-size: 28px;
						font-weight: bold;
						margin: 0;
						display: flex;
						align-items: center;
						justify-content: center;

		}

					.header-title i {
							margin-left: 10px; /* Adjust margin for RTL */

		}

				.back-button {
						position: absolute;
						right: 20px;
						top: 50%;
						transform: translateY(-50%);
						background: rgba(255,255,255,0.2);
						border: none;
						color: white;
						padding: 10px 15px;
						border-radius: 8px;
						transition: all 0.3s ease;
						text-decoration: none;
						display: flex;
						align-items: center;

		}

					.back-button:hover {
							background: rgba(255,255,255,0.3);
							color: white;

		}

				.card-body {
						padding: 40px;

		}

				.form-label {
						font-weight: 600;
						color: #ff8a50; /* Orange color for labels */
						margin-bottom: 8px;
						display: block;
						font-size: 1.1rem;

		}

				.form-control, .form-select {
						border-radius: 10px;
						border: 2px solid #e9ecef;
						padding: 12px 15px;
						transition: all 0.3s ease;
						font-size: 16px;

		}

						.form-control:focus, .form-select:focus {
								border-color: #ff8a50; /* Orange border on focus */
								box-shadow: 0 0 0 0.2rem rgba(255, 138, 80, 0.25);

			}

					.form-control:read-only {
							background-color: #f8f9fa;
							border-color: #dee2e6;
							color: #6c757d;

		}

				.form-check {
						margin-bottom: 20px;

		}

				.form-check-input:checked {
						background-color: #ff8a50; /* Orange for checked checkbox */
						border-color: #ff8a50;

		}

				.form-check-label {
						font-weight: 500;
						color: #333;
						margin-right: 10px; /* Adjust margin for RTL */

		}

				.btn-primary {
						background: linear-gradient(135deg, #ff8a50, #ff6b35); /* Orange gradient for primary button */
						border: none;
						padding: 12px 30px;
						font-size: 16px;
						font-weight: 600;
						border-radius: 10px;
						color: white;
						transition: all 0.3s ease;

		}

					.btn-primary:hover {
							background: linear-gradient(135deg, #ff6b35, #ff8a50);
							transform: translateY(-2px);
							box-shadow: 0 5px 15px rgba(255, 138, 80, 0.4);
							color: white;

		}

				.btn-secondary {
						background: #6c757d;
						border: none;
						padding: 12px 30px;
						font-size: 16px;
						font-weight: 600;
						border-radius: 10px;
						color: white;
						transition: all 0.3s ease;

		}

					.btn-secondary:hover {
							background: #5a6268;
							transform: translateY(-2px);

		}

				.text-danger {
						font-size: 14px;
						margin-top: 5px;
						color: #dc3545 !important;

		}

				.required {
						color: #dc3545;

		}

				.input-group {
						position: relative;

		}

				.form-icon {
						position: absolute;
						left: 15px; /* Adjust position for RTL */
						top: 50%;
						transform: translateY(-50%);
						color: #ced4da; /* Light gray for icons */
						pointer-events: none; /* Make icon not interfere with input clicks */

		}

				.form-control.is-invalid + .form-icon {
						color: #dc3545; /* Red icon for invalid input */

		}

				.alert {
						border-radius: 8px;
						margin-bottom: 20px;

		}

				.validation-summary-errors {
						background-color: #f8d7da;
						border: 1px solid #f5c6cb;
						color: #721c24;
						padding: 12px;
						border-radius: 8px;
						margin-bottom: 20px;

		}

					.validation-summary-errors ul {
							margin: 0;
							padding-right: 20px;

		}

				.info-section {
						background-color: #fff3e0; /* Light orange background */
						padding: 15px;
						border-radius: 8px;
						margin-bottom: 20px;
						border: 1px solid #ffcc80; /* Orange border */

		}

				.info-label {
						font-weight: 600;
						color: #e65100; /* Darker orange for info label */
						margin-bottom: 5px;

		}

				.info-value {
						color: #ff8a50; /* Orange for info value */
						font-weight: 500;

		}


	</style>
</head>
<body>
	<div class="container-fluid p-4">
		<div class="row justify-content-center">
			<div class="col-md-8 col-lg-6">
				<div class="card">
					<div class="card-header position-relative">
						<a href="@Url.Action("Index")" class="back-button">
							<i class="fas fa-arrow-right me-2"></i>
							العودة
						</a>
						<h1 class="header-title">
							<i class="fas fa-edit"></i>تعديل الفصل
						</h1>
					</div>

					<div class="card-body">
						@if (TempData["SuccessMessage"] != null)
						{
							<div class="alert alert-success">
								<i class="fas fa-check-circle me-2"></i>
								@TempData["SuccessMessage"]
							</div>
						}

						@if (TempData["ErrorMessage"] != null)
						{
							<div class="alert alert-danger">
								<i class="fas fa-exclamation-circle me-2"></i>
								@TempData["ErrorMessage"]
							</div>
						}

						<form asp-action="Edit" method="post" id="editClassForm">
							<div asp-validation-summary="ModelOnly" class="validation-summary-errors"></div>

							<input type="hidden" asp-for="Id" />
							<input type="hidden" asp-for="Date" />
							<input type="hidden" asp-for="CreatedBy" />

							<div class="mb-4">
								<label asp-for="Name" class="form-label">
									اسم الفصل <span class="required">*</span>
								</label>
								<div class="input-group">
									<input asp-for="Name" class="form-control form-control-lg" placeholder="أدخل اسم الفصل" required />
									<i class="fas fa-graduation-cap form-icon"></i>
								</div>
								<span asp-validation-for="Name" class="text-danger"></span>
							</div>

							<div class="mb-4">
								<label asp-for="MaxStudents" class="form-label fw-bold text-primary-orange">
									<i class="fas fa-user-friends me-2"></i>السعة القصوى للطلاب <span class="required">*</span>
								</label>
								<input asp-for="MaxStudents" type="number" class="form-control form-control-lg" id="maxStudentsInput" placeholder="ادخل السعة القصوى" required />
								<span asp-validation-for="MaxStudents" class="text-danger"></span>
								<div id="maxStudentsError" class="text-danger mt-1" style="display:none;">
									<i class="fas fa-exclamation-circle me-1"></i>
									عفواً، لا يمكنك كتابة أحرف في هذا الحقل.
								</div>
							</div>


							<div class="info-section">
								<div class="info-label">تاريخ الإنشاء</div>
								<div class="info-value">
									<i class="fas fa-calendar me-2"></i>
									@Model.Date.ToString("dd/MM/yyyy - hh:mm tt")
								</div>
							</div>

							<div class="row">
								<div class="col-md-6 mb-3">
									<button type="submit" class="btn btn-primary w-100">
										<i class="fas fa-save me-2"></i>
										تحديث الفصل
									</button>
								</div>
								<div class="col-md-6 mb-3">
									<a href="@Url.Action("Index")" class="btn btn-secondary w-100">
										<i class="fas fa-times me-2"></i>
										إلغاء
									</a>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
	<script>
		const maxStudentsInput = document.getElementById('maxStudentsInput');
		const maxStudentsError = document.getElementById('maxStudentsError');
		const nameInput = document.querySelector('input[name="Name"]');

		function validateMaxStudents(inputValue) {
			const hasNonNumeric = /[^\d]/.test(inputValue);
			if (hasNonNumeric) {
				maxStudentsInput.classList.add('is-invalid');
				maxStudentsError.style.display = 'block';
				return false;
			} else {
				maxStudentsInput.classList.remove('is-invalid');
				maxStudentsError.style.display = 'none';
				return true;
			}
		}

		// Real-time input filtering and validation
		maxStudentsInput.addEventListener('input', function (e) {
			const originalValue = this.value;
			// Remove non-numeric characters
			const filteredValue = originalValue.replace(/[^0-9]/g, '');
			// Update the input value with only numbers
			this.value = filteredValue;

			// Show error message if original value contained non-numeric chars
			if (originalValue !== filteredValue) {
				maxStudentsInput.classList.add('is-invalid');
				maxStudentsError.style.display = 'block';
			} else {
				maxStudentsInput.classList.remove('is-invalid');
				maxStudentsError.style.display = 'none';
			}
		});

		// Handle paste events to remove non-numeric characters and validate
		maxStudentsInput.addEventListener('paste', function(e) {
			const pasteData = e.clipboardData.getData('text/plain');
			const filteredData = pasteData.replace(/[^0-9]/g, '');

			// If non-numeric characters were present, show error
			if (pasteData !== filteredData) {
				maxStudentsInput.classList.add('is-invalid');
				maxStudentsError.style.display = 'block';
			}

			// Prevent default paste behavior and insert the filtered data
			e.preventDefault();
			const currentVal = this.value;
			const selectionStart = this.selectionStart;
			const selectionEnd = this.selectionEnd;
			this.value = currentVal.substring(0, selectionStart) + filteredData + currentVal.substring(selectionEnd);
			this.setSelectionRange(selectionStart + filteredData.length, selectionStart + filteredData.length);
		});

		// Client-side validation on form submission
		document.getElementById('editClassForm').addEventListener('submit', function (e) {
			let isValid = true;
			const nameErrorSpan = document.querySelector('span[data-valmsg-for="Name"]');
			const maxStudentsValue = maxStudentsInput.value.trim();

			// Clear previous errors
			nameInput.classList.remove('is-invalid');
			maxStudentsInput.classList.remove('is-invalid');
			if (nameErrorSpan) nameErrorSpan.textContent = '';
			maxStudentsError.style.display = 'none';

			// Validate Name field
			if (!nameInput.value.trim()) {
				isValid = false;
				nameInput.classList.add('is-invalid');
				if (nameErrorSpan) nameErrorSpan.textContent = 'اسم الفصل مطلوب.';
			}

			// Validate MaxStudents field
			const isNumber = /^\d+$/.test(maxStudentsValue);
			const numberValue = parseInt(maxStudentsValue, 10);

			// Check for empty or non-numeric value or zero/negative number
			if (!maxStudentsValue || !isNumber || numberValue <= 0) {
				isValid = false;
				maxStudentsInput.classList.add('is-invalid');
				maxStudentsError.style.display = 'block';
				maxStudentsError.textContent = 'يجب إدخال رقم صحيح موجب للسعة القصوى.';
			}


			if (isValid) {
				// Confirmation dialog before submission
				if (!confirm('هل أنت متأكد من تحديث بيانات الفصل؟')) {
					e.preventDefault(); // Prevent form submission if user cancels
				}
			} else {
				e.preventDefault(); // Prevent form submission if validation fails
			}
		});

		// Remove is-invalid class on input for better UX
		document.querySelectorAll('.form-control').forEach(function (element) {
			element.addEventListener('input', function () {
				if (this.classList.contains('is-invalid')) {
					this.classList.remove('is-invalid');
					const errorSpan = document.querySelector(`span[data-valmsg-for="${this.name}"]`);
					if (errorSpan) {
						errorSpan.textContent = '';
					}
				}
			});
		});
	</script>
</body>
</html>