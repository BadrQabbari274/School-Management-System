@model StudentManagementSystem.Models.Classes

@{
    ViewData["Title"] = "إنشاء فصل جديد";
    Layout = "~/Views/Shared/_Layout.cshtml"; 
}

<div class="container-fluid p-4">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div class="card border-0 shadow-lg">
                <div class="card-header bg-primary-orange text-white text-center py-4">
                    <h3 class="mb-0 fw-bold">
                        <i class="fas fa-plus-circle me-2"></i>إنشاء فصل جديد
                    </h3>
                </div>

                <div class="card-body p-5">
                    @if (TempData["SuccessMessage"] != null)
                    {
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                            <i class="fas fa-check-circle me-2"></i>
                            @TempData["SuccessMessage"]
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    }

                    @if (TempData["ErrorMessage"] != null)
                    {
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            <i class="fas fa-exclamation-circle me-2"></i>
                            @TempData["ErrorMessage"]
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    }

                    <form asp-action="Create" method="post">
                        <div asp-validation-summary="ModelOnly" class="text-danger mb-4 text-center custom-validation-summary"></div>

                        <div class="mb-4">
                            <label asp-for="Name" class="form-label fw-bold text-primary-orange">
                                <i class="fas fa-chalkboard me-2"></i>اسم الفصل <span class="required">*</span>
                            </label>
                            <input asp-for="Name" class="form-control form-control-lg" placeholder="أدخل اسم الفصل" required />
                            <span asp-validation-for="Name" class="text-danger"></span>
                        </div>

                        <div class="mb-4">
                            <label asp-for="MaxStudents" class="form-label fw-bold text-primary-orange">
                                <i class="fas fa-user-friends me-2"></i>السعة القصوى للطلاب <span class="required">*</span>
                            </label>
                            <input asp-for="MaxStudents" type="number" class="form-control form-control-lg" placeholder="ادخل السعة القصوى" required />
                            <span asp-validation-for="MaxStudents" class="text-danger"></span>
                        </div>


                        <div class="row">
                            <div class="col-md-6">
                                <button type="submit" class="btn btn-primary-orange btn-lg w-100 mb-3">
                                    <i class="fas fa-save me-2"></i>إنشاء الفصل
                                </button>
                            </div>
                            <div class="col-md-6">
                                <a asp-action="Index" class="btn btn-outline-secondary-orange btn-lg w-100">
                                    <i class="fas fa-arrow-right me-2"></i>العودة إلى القائمة
                                </a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f8f9fa;
        direction: rtl; /* Ensure RTL direction for the whole page */
        text-align: right; /* Align text to the right by default */
    }

    .card {
        border-radius: 20px;
        overflow: hidden;
    }

    /* Custom orange gradient for header and primary buttons */
    .bg-primary-orange {
        background: linear-gradient(135deg, #FF8C00 0%, #FF6B35 100%); /* Adjusted to a more vibrant orange */
        border: none;
    }

    .card-header {
        border: none;
    }

    .form-control, .form-select {
        border-radius: 10px;
        border: 2px solid #e9ecef;
        padding: 12px 15px;
        transition: all 0.3s ease;
        text-align: right; /* Ensure text input is aligned right within the field */
    }

        .form-control::placeholder {
            text-align: right; /* Align placeholder text to the right */
        }

        .form-control:focus, .form-select:focus {
            border-color: #FF8C00; /* Orange focus color */
            box-shadow: 0 0 0 0.2rem rgba(255, 140, 0, 0.25); /* Orange shadow on focus */
        }

    .btn-primary-orange {
        background: linear-gradient(135deg, #FF8C00 0%, #FF6B35 100%);
        border: none;
        border-radius: 10px;
        padding: 12px 24px;
        transition: all 0.3s ease;
    }

        .btn-primary-orange:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 140, 0, 0.4);
            background: linear-gradient(135deg, #FF6B35 0%, #FF8C00 100%); /* Slight change on hover */
        }

    .btn-outline-secondary-orange {
        border-radius: 10px;
        padding: 12px 24px;
        transition: all 0.3s ease;
        border-color: #FF8C00; /* Orange border for outline button */
        color: #FF8C00; /* Orange text for outline button */
    }

        .btn-outline-secondary-orange:hover {
            transform: translateY(-2px);
            background-color: #FF8C00; /* Orange background on hover */
            color: white; /* White text on hover */
            box-shadow: 0 8px 25px rgba(255, 140, 0, 0.2);
        }

    .text-primary-orange {
        color: #FF8C00 !important; /* Orange text for labels */
    }

    .form-label {
        margin-bottom: 8px;
        font-size: 1.1rem;
    }

    .required {
        color: #dc3545; /* Red color for required asterisk */
    }

    .alert {
        border-radius: 8px;
    }

    /* Custom styling for validation summary to match design */
    .custom-validation-summary {
        background-color: #fff3cd; /* Light yellow background */
        border: 1px solid #ffeeba; /* Yellow border */
        color: #856404; /* Dark yellow text */
        padding: 15px;
        border-radius: 8px;
    }
</style>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        // Optional: Custom client-side validation for "Name" and "MaxStudents"
        document.querySelector('form').addEventListener('submit', function(e) {
            let isValid = true;

            const nameInput = document.querySelector('input[name="Name"]');
            if (nameInput && nameInput.value.trim() === '') {
                isValid = false;
                nameInput.classList.add('is-invalid');
                if (!nameInput.nextElementSibling || !nameInput.nextElementSibling.classList.contains('text-danger')) {
                    const span = document.createElement('span');
                    span.className = 'text-danger';
                    span.textContent = 'اسم الفصل مطلوب.';
                    nameInput.parentNode.appendChild(span);
                }
            } else if (nameInput) {
                nameInput.classList.remove('is-invalid');
                const existingError = nameInput.parentNode.querySelector('.text-danger');
                if (existingError && existingError.textContent === 'اسم الفصل مطلوب.') {
                    existingError.remove();
                }
            }

            const maxStudentsInput = document.querySelector('input[name="MaxStudents"]');
            if (maxStudentsInput && (maxStudentsInput.value.trim() === '' || isNaN(maxStudentsInput.value) || parseInt(maxStudentsInput.value) <= 0)) {
                isValid = false;
                maxStudentsInput.classList.add('is-invalid');
                if (!maxStudentsInput.nextElementSibling || !maxStudentsInput.nextElementSibling.classList.contains('text-danger')) {
                    const span = document.createElement('span');
                    span.className = 'text-danger';
                    span.textContent = 'السعة القصوى مطلوبة ويجب أن تكون رقمًا موجبًا.';
                    maxStudentsInput.parentNode.appendChild(span);
                }
            } else if (maxStudentsInput) {
                maxStudentsInput.classList.remove('is-invalid');
                const existingError = maxStudentsInput.parentNode.querySelector('.text-danger');
                if (existingError && existingError.textContent === 'السعة القصوى مطلوبة ويجب أن تكون رقمًا موجبًا.') {
                    existingError.remove();
                }
            }

            if (!isValid) {
                e.preventDefault();
            } else {
                // Confirmation dialog for submission
                if (!confirm('هل أنت متأكد من إنشاء هذا الفصل؟')) {
                    e.preventDefault();
                }
            }
        });

        // Remove validation error on input change
        document.querySelectorAll('.form-control, .form-select').forEach(function(element) {
            element.addEventListener('input', function() {
                this.classList.remove('is-invalid');
                const errorSpan = this.nextElementSibling;
                if (errorSpan && errorSpan.classList.contains('text-danger')) {
                    errorSpan.textContent = ''; // Clear the text
                }
            });
        });
    </script>
}